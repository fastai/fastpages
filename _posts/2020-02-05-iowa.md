---

title: Fred's Iowa Notebook

keywords: fastai
sidebar: home_sidebar

summary: "A test notebook"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/iowa.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Where did I get this notebook?
{% include twitter.html content='<code>https://twitter.com/313V/status/1225229621693730817?s=20</code>' %}</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">requests</span> <span class="k">as</span> <span class="nn">r</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">bs4</span> <span class="kn">import</span> <span class="n">BeautifulSoup</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Get HTML</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://results.thecaucuses.org/&#39;</span>
<span class="n">resp</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">soup</span> <span class="o">=</span> <span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">text</span><span class="p">);</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Parse HTML</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">precinct_table</span> <span class="o">=</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;precinct-table&#39;</span><span class="p">})</span>
<span class="n">thead</span> <span class="o">=</span> <span class="p">[</span><span class="n">li</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;ul&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;thead&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">)]</span>
<span class="n">sub_head</span> <span class="o">=</span> <span class="p">[</span><span class="n">li</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">li</span> <span class="ow">in</span> <span class="n">soup</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;ul&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;sub-head&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">)]</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">candidates</span> <span class="o">=</span> <span class="p">[</span><span class="n">thead</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">thead</span><span class="p">),</span> <span class="mi">3</span><span class="p">)]</span>
<span class="n">counties</span> <span class="o">=</span> <span class="n">precinct_table</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;precinct-rows&#39;</span><span class="p">})</span>
<span class="n">county</span> <span class="o">=</span> <span class="n">counties</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">county</span> <span class="ow">in</span> <span class="n">counties</span><span class="p">:</span>
    <span class="n">county_name</span> <span class="o">=</span> <span class="n">county</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;precinct-county&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;wrap&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">text</span>
    <span class="n">county_data</span> <span class="o">=</span> <span class="n">county</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;class&#39;</span><span class="p">:</span> <span class="s1">&#39;precinct-data&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s1">&#39;ul&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">v</span> <span class="o">!=</span> <span class="s1">&#39;total-row&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">county_data</span><span class="p">:</span>
        <span class="n">row_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">row</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">)]</span>
        <span class="n">precinct_name</span> <span class="o">=</span> <span class="n">row_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">row_data</span><span class="p">),</span> <span class="mi">3</span><span class="p">):</span>
            <span class="n">first_exp</span><span class="p">,</span> <span class="n">final_exp</span><span class="p">,</span> <span class="n">sde</span> <span class="o">=</span> <span class="n">row_data</span><span class="p">[</span><span class="n">i</span><span class="p">:(</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">)]</span>
            <span class="n">candidate</span> <span class="o">=</span> <span class="n">candidates</span><span class="p">[</span><span class="n">i</span><span class="o">//</span><span class="mi">3</span><span class="p">]</span>
            <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">county</span><span class="o">=</span><span class="n">county_name</span><span class="p">,</span> <span class="n">precinct</span><span class="o">=</span><span class="n">precinct_name</span><span class="p">,</span> <span class="n">candidate</span><span class="o">=</span><span class="n">candidate</span><span class="p">,</span> 
                             <span class="n">first_exp</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">first_exp</span><span class="p">),</span> <span class="n">final_exp</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">final_exp</span><span class="p">),</span> <span class="n">sde</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">sde</span><span class="p">)))</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s1">&#39;county&#39;</span><span class="p">,</span> <span class="s1">&#39;precinct&#39;</span><span class="p">,</span> <span class="s1">&#39;candidate&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;candidate&#39;</span><span class="p">,</span> <span class="s1">&#39;county&#39;</span><span class="p">])[[</span><span class="s1">&#39;first_exp&#39;</span><span class="p">,</span> <span class="s1">&#39;final_exp&#39;</span><span class="p">,</span> <span class="s1">&#39;sde&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>first_exp</th>
      <th>final_exp</th>
      <th>sde</th>
    </tr>
    <tr>
      <th>candidate</th>
      <th>county</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="30" valign="top">Bennet</th>
      <th>Adair</th>
      <td>0</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Adams</th>
      <td>0</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Allamakee</th>
      <td>1</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Appanoose</th>
      <td>0</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Audubon</th>
      <td>0</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Benton</th>
      <td>0</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Black Hawk</th>
      <td>2</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Boone</th>
      <td>3</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Bremer</th>
      <td>0</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Buchanan</th>
      <td>0</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Buena Vista</th>
      <td>0</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Butler</th>
      <td>0</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>CD2 Satellite</th>
      <td>0</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>CD4 Satellite</th>
      <td>0</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Calhoun</th>
      <td>0</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Carroll</th>
      <td>0</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Cass</th>
      <td>0</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Cedar</th>
      <td>1</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Cerro Gordo</th>
      <td>0</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Cherokee</th>
      <td>0</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Chickasaw</th>
      <td>0</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Clarke</th>
      <td>0</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Clay</th>
      <td>1</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Clayton</th>
      <td>0</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Clinton</th>
      <td>0</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Crawford</th>
      <td>0</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Dallas</th>
      <td>4</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Davis</th>
      <td>0</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Decatur</th>
      <td>1</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Delaware</th>
      <td>0</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th rowspan="30" valign="top">Yang</th>
      <th>O'Brien</th>
      <td>3</td>
      <td>3</td>
      <td>0.0727</td>
    </tr>
    <tr>
      <th>Osceola</th>
      <td>0</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Out of State Satellite</th>
      <td>23</td>
      <td>7</td>
      <td>0.0216</td>
    </tr>
    <tr>
      <th>Page</th>
      <td>16</td>
      <td>7</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Palo Alto</th>
      <td>4</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Plymouth</th>
      <td>39</td>
      <td>13</td>
      <td>0.2250</td>
    </tr>
    <tr>
      <th>Pocahontas</th>
      <td>11</td>
      <td>7</td>
      <td>0.1200</td>
    </tr>
    <tr>
      <th>Polk</th>
      <td>1683</td>
      <td>23</td>
      <td>0.2798</td>
    </tr>
    <tr>
      <th>Pottawattamie</th>
      <td>172</td>
      <td>114</td>
      <td>1.9200</td>
    </tr>
    <tr>
      <th>Poweshiek</th>
      <td>91</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Ringgold</th>
      <td>1</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Sac</th>
      <td>5</td>
      <td>3</td>
      <td>0.0667</td>
    </tr>
    <tr>
      <th>Scott</th>
      <td>415</td>
      <td>86</td>
      <td>0.4133</td>
    </tr>
    <tr>
      <th>Shelby</th>
      <td>2</td>
      <td>1</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Sioux</th>
      <td>64</td>
      <td>56</td>
      <td>0.4375</td>
    </tr>
    <tr>
      <th>Story</th>
      <td>716</td>
      <td>246</td>
      <td>1.6600</td>
    </tr>
    <tr>
      <th>Tama</th>
      <td>15</td>
      <td>14</td>
      <td>0.2588</td>
    </tr>
    <tr>
      <th>Taylor</th>
      <td>7</td>
      <td>6</td>
      <td>0.2000</td>
    </tr>
    <tr>
      <th>Union</th>
      <td>26</td>
      <td>7</td>
      <td>0.1500</td>
    </tr>
    <tr>
      <th>Van Buren</th>
      <td>0</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Wapello</th>
      <td>31</td>
      <td>14</td>
      <td>0.2700</td>
    </tr>
    <tr>
      <th>Warren</th>
      <td>87</td>
      <td>3</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Washington</th>
      <td>31</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Wayne</th>
      <td>3</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>Webster</th>
      <td>36</td>
      <td>4</td>
      <td>0.0833</td>
    </tr>
    <tr>
      <th>Winnebago</th>
      <td>30</td>
      <td>29</td>
      <td>0.4500</td>
    </tr>
    <tr>
      <th>Winneshiek</th>
      <td>151</td>
      <td>49</td>
      <td>0.5120</td>
    </tr>
    <tr>
      <th>Woodbury</th>
      <td>159</td>
      <td>40</td>
      <td>0.6375</td>
    </tr>
    <tr>
      <th>Worth</th>
      <td>27</td>
      <td>23</td>
      <td>0.4000</td>
    </tr>
    <tr>
      <th>Wright</th>
      <td>5</td>
      <td>0</td>
      <td>0.0000</td>
    </tr>
  </tbody>
</table>
<p>1428 rows Ã— 3 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;iowa_data.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>
 

